# OddsTracker - RÃ¨gles de DÃ©veloppement

## ğŸ¯ Contexte du Projet

Application web d'analyse de cotes sportives historiques depuis janvier 2019.
Client : Codeur Ben | Prix : 950â‚¬ TTC | DÃ©lai : ~5 jours

## ğŸ“š Stack Technique

### Framework & Langage
- **Next.js 14** (App Router obligatoire)
- **TypeScript 5+** (mode strict activÃ©)
- **React 18.3** (Server Components par dÃ©faut)

### UI & Styling
- **Tailwind CSS 3.4** (utility-first)
- **shadcn/ui** (16 composants installÃ©s)
- **Lucide React** (icÃ´nes)
- **Palette sobre et professionnelle** (bleu foncÃ© #1e40af)

### Data & Backend
- **Supabase** (PostgreSQL, Free Tier)
- **TanStack Table v8** (tableaux interactifs)
- **OddsPapi API** (donnÃ©es de cotes)
- **Bookmaker Pinnacle uniquement**

### Auth & Export
- **jose** (JWT sessions, 7 jours)
- **bcryptjs** (hachage mot de passe)
- **ExcelJS** (export XLSX, pas xlsx)
- **date-fns** (formatage dates)

## ğŸ¨ Conventions de Code

### Nommage
- **Fichiers** : kebab-case (`user-profile.tsx`, `api-client.ts`)
- **Composants** : PascalCase (`UserProfile`, `DataTable`)
- **Fonctions/Variables** : camelCase (`getUserData`, `isLoading`)
- **Types/Interfaces** : PascalCase (`User`, `ApiResponse`)
- **Constantes** : UPPER_SNAKE_CASE (`API_BASE_URL`)

### Structure de Fichiers
- **Types** â†’ `/types`
- **Composants UI** â†’ `/components/ui`
- **Composants mÃ©tier** â†’ `/components/{domain}`
- **Hooks** â†’ `/hooks`
- **Utils** â†’ `/lib/utils`
- **Services** â†’ `/lib/{service}`

### TypeScript
- **Mode strict activÃ©** (pas de `any` sans justification)
- **Types explicites** pour les paramÃ¨tres de fonction
- **Interfaces** pour les objets complexes
- **Pas de `as` casting** sauf absolument nÃ©cessaire

### React & Next.js
- **Server Components par dÃ©faut** (sauf interactivitÃ©)
- **'use client'** uniquement si hooks/events nÃ©cessaires
- **Composants purs** quand possible
- **Pas de props drilling** (Context si nÃ©cessaire)

## ğŸ¨ UI & Design

### Couleurs
```css
/* Principales */
--primary: #1e40af (Bleu foncÃ©)
--background: #ffffff (Blanc)
--foreground: #0f172a (Noir slate)

/* RÃ©sultats */
--winner: #16a34a (Vert - Pari gagnant)
--winner-bg: #dcfce7 (Vert clair)
--loser: #dc2626 (Rouge - Pari perdant)
--loser-bg: #fee2e2 (Rouge clair)

/* Neutrales */
--muted: #f1f5f9 (Gris clair)
--border: #e2e8f0 (Gris bordure)
```

### Principes
- **Desktop-first, mobile-friendly**
- **Pas d'emojis** sauf demande explicite
- **Sobre et professionnel**
- **Pas de traces IA** dans le code

### Composants
- **Utiliser shadcn/ui** en prioritÃ©
- **Import depuis** `@/components/ui`
- **Variantes winner/loser** pour badges
- **Toaster** pour notifications

## ğŸ”’ SÃ©curitÃ©

### VulnÃ©rabilitÃ©s
- âœ… **exceljs** (pas xlsx - vulnÃ©rable)
- âœ… **VÃ©rifier npm audit** avant commit
- âœ… **Pas de secrets** dans le code
- âœ… **Variables d'env** pour tout

### Auth
- **Mot de passe unique** (pas de multi-users)
- **Session JWT** (7 jours, HTTP-only cookie)
- **Middleware** protÃ¨ge toutes les routes sauf /login
- **Pas de tokens** en localStorage

## ğŸ“Š Base de DonnÃ©es

### Tables Principales
- `sports` (4 sports : Football, Hockey, Tennis, Volleyball)
- `fixtures` (matchs)
- `odds` (cotes opening/closing)
- `leagues`, `teams`, `countries`
- `markets`, `outcomes`
- `settings`, `sync_logs`

### RequÃªtes
- **Supabase client** via `lib/db/index.ts`
- **Queries organisÃ©es** dans `lib/db/queries/`
- **Index optimisÃ©s** dÃ©jÃ  en place
- **Pagination cÃ´tÃ© serveur** obligatoire

## ğŸ”Œ API OddsPapi

### RÃ¨gles Strictes
- **Bookmaker Pinnacle uniquement** (paramÃ¨tre `bookmakers=pinnacle`)
- **Rate limits** :
  - `/v4/historical-odds` : 5000ms entre requÃªtes
  - `/v4/odds-by-tournaments` : 1000ms entre requÃªtes
- **Queue systÃ¨me** pour gÃ©rer les dÃ©lais
- **Logger toutes erreurs** dans `sync_logs`

### Endpoints
- `GET /v4/sports` - Sports disponibles
- `GET /v4/tournaments` - CompÃ©titions
- `GET /v4/fixtures` - Matchs
- `GET /v4/historical-odds` - Cotes historiques
- `GET /v4/settlements` - RÃ©sultats
- `GET /account` - Quota API

## ğŸ“ Bonnes Pratiques

### Code Quality
- âŒ **Pas de console.log** en production
- âŒ **Pas de commentaires Ã©vidents** ("// Boucle sur les items")
- âœ… **Code concis et lisible**
- âœ… **DRY** (Don't Repeat Yourself)
- âœ… **KISS** (Keep It Simple, Stupid)

### Performance
- **Pagination** obligatoire pour les listes
- **Lazy loading** pour composants lourds
- **MÃ©moÃ¯sation** quand pertinent
- **Index DB** dÃ©jÃ  optimisÃ©s

### Git
- **Commits clairs** et concis
- **Pas de credentials** dans le code
- **package-lock.json** committÃ©
- **.env.local** dans .gitignore

## ğŸ¯ FonctionnalitÃ©s ClÃ©s

### Tableaux (TanStack Table)
- **Tri** sur toutes colonnes
- **Pagination** (25/50/100 par page)
- **Filtres** multiples (pays, ligue, Ã©quipe, date, cotes)
- **Colonnes dynamiques** selon marchÃ©s disponibles
- **VisibilitÃ©** personnalisable (localStorage)

### Export
- **CSV** avec UTF-8 BOM
- **XLSX** avec ExcelJS (styles, formats)
- **Respecte filtres** et colonnes visibles
- **Nom de fichier** avec date/sport

### Coloration
- **Vert** : Pari gagnant (cote + rÃ©sultat)
- **Rouge** : Pari perdant
- **Neutre** : Match non terminÃ©
- **Logique** dans `lib/utils/winner-detection.ts`

### Synchronisation
- **Cron quotidien** 6h (Vercel Cron)
- **Sync manuelle** depuis rÃ©glages
- **Import historique** depuis 01/2019 (une fois)
- **Logs dÃ©taillÃ©s** dans `sync_logs`

## ğŸ“‚ RÃ©fÃ©rence Rapide

### Imports FrÃ©quents
```typescript
// UI Components
import { Button, Input, Select } from "@/components/ui";

// Utils
import { cn } from "@/lib/utils";
import { formatDate } from "@/lib/utils/date";
import { formatOdds } from "@/lib/utils/odds-format";

// DB
import { supabase } from "@/lib/db";

// Hooks
import { useToast } from "@/hooks/use-toast";
```

### Routes API
- `/api/auth/login` - POST
- `/api/auth/logout` - POST
- `/api/fixtures/[sport]` - GET
- `/api/sync/manual` - POST
- `/api/sync/cron` - GET
- `/api/export/csv` - POST
- `/api/export/xlsx` - POST

## ğŸš« Ã€ Ã‰viter

### Code
- âŒ `any` sans justification
- âŒ Inline styles (utiliser Tailwind)
- âŒ console.log en production
- âŒ Commentaires Ã©vidents
- âŒ Props drilling excessif
- âŒ Composants monolithiques (>300 lignes)

### UI
- âŒ Emojis (sauf demande explicite)
- âŒ Couleurs flashy
- âŒ Animations excessives
- âŒ Traces IA dans les messages

### Data
- âŒ Bookmaker autre que Pinnacle
- âŒ RequÃªtes API sans rate limit
- âŒ DonnÃ©es en dur (utiliser DB)
- âŒ Fetch cÃ´tÃ© client si possible cÃ´tÃ© serveur

## ğŸ“– Documentation

### PrioritÃ© de Lecture
1. **PROJECT_SPEC.md** - SpÃ©cifications complÃ¨tes (37 KB)
2. **NEXT_STEPS.md** - Plan de dÃ©veloppement
3. **components/ui/README.md** - Guide composants

### Commandes Utiles
```bash
npm run dev        # Dev server
npm run build      # Build production
npm run lint       # ESLint
npm audit          # SÃ©curitÃ©
```

## ğŸ¯ Objectif Final

Application pro, sobre, performante permettant d'analyser les cotes historiques sportives avec tableaux interactifs, filtres avancÃ©s et exports.

**DÃ©lai** : ~5 jours | **Budget** : 950â‚¬ | **QualitÃ©** : Production-ready

---

**Toujours consulter PROJECT_SPEC.md pour les dÃ©tails d'implÃ©mentation.**
